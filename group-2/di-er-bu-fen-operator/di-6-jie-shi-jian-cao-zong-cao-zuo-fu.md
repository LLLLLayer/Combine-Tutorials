# ç¬¬ 6 èŠ‚ï¼šæ—¶é—´æ“çºµæ“ä½œç¬¦

### ç¬¬ 6 èŠ‚ï¼šæ—¶é—´æ“çºµæ“ä½œç¬¦

ååº”å¼ç¼–ç¨‹èƒŒåçš„æ ¸å¿ƒæ€æƒ³æ˜¯éšç€æ—¶é—´çš„æ¨ç§»å¯¹å¼‚æ­¥äº‹ä»¶æµè¿›è¡Œå»ºæ¨¡ã€‚åœ¨è¿™æ–¹é¢ï¼ŒCombine æ¡†æ¶æä¾›äº†ä¸€ç³»åˆ—å…è®¸ä½ å¤„ç†æ—¶é—´çš„æ“ä½œç¬¦ã€‚ç‰¹åˆ«æ˜¯åºåˆ—å¦‚ä½•éšç€æ—¶é—´çš„æ¨ç§»å¯¹å€¼åšå‡ºååº”å’Œè½¬æ¢ã€‚

ç®¡ç†å€¼åºåˆ—çš„æ—¶é—´ç»´åº¦ç®€å•ç›´æ¥ï¼Œè¿™æ˜¯ä½¿ç”¨ Combine è¿™æ ·çš„æ¡†æ¶çš„ä¸€å¤§å¥½å¤„ã€‚

#### å…¥é—¨

è¦äº†è§£æ—¶é—´æ“ä½œæ“ä½œç¬¦ï¼Œä½ å°†ä½¿ç”¨åŠ¨ç”» Xcode Playground è¿›è¡Œç»ƒä¹ ï¼Œè¯¥ Playground å¯è§†åŒ–æ•°æ®å¦‚ä½•éšæ—¶é—´æµåŠ¨ã€‚æœ¬ç« é™„å¸¦ä¸€ä¸ª Playgroundï¼Œä½ å¯ä»¥åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°ã€‚

Playground åˆ†ä¸ºå‡ ä¸ªé¡µé¢ã€‚ä½ å°†ä½¿ç”¨æ¯ä¸ªé¡µé¢æ¥ç»ƒä¹ ä¸€ä¸ªæˆ–å¤šä¸ªç›¸å…³æ“ä½œç¬¦ã€‚å®ƒè¿˜åŒ…æ‹¬ä¸€äº›ç°æˆçš„ç±»ã€å‡½æ•°å’Œç¤ºä¾‹æ•°æ®ï¼Œå¯ç”¨äºæ„å»ºç¤ºä¾‹ã€‚

å¦‚æœä½ å°† Playground è®¾ç½®ä¸ºæ˜¾ç¤ºæ¸²æŸ“æ ‡è®°ï¼Œåˆ™åœ¨æ¯ä¸ªé¡µé¢çš„åº•éƒ¨éƒ½ä¼šæœ‰ä¸€ä¸ª Next é“¾æ¥ï¼Œä½ å¯ä»¥å•å‡»è¯¥é“¾æ¥è½¬åˆ°ä¸‹ä¸€é¡µã€‚

> æ³¨æ„ï¼šè¦æ‰“å¼€å’Œå…³é—­æ˜¾ç¤ºæ¸²æŸ“æ ‡è®°ï¼Œè¯·ä»èœå•ä¸­é€‰æ‹© Editor â–¸ Show Rendered/Raw Markupã€‚

ä½ è¿˜å¯ä»¥ä»å·¦ä¾§è¾¹æ ä¸­çš„é¡¹ç›®å¯¼èˆªå™¨ç”šè‡³é¡µé¢é¡¶éƒ¨çš„è·³è½¬æ ä¸­é€‰æ‹©æ‰€éœ€çš„é¡µé¢ã€‚

æŸ¥çœ‹ Xcodeï¼Œä½ ä¼šåœ¨çª—å£çš„å·¦ä¸Šè§’çœ‹åˆ°ä¾§è¾¹æ æ§ä»¶ï¼š

1. ç¡®ä¿å·¦ä¾§è¾¹æ æŒ‰é’®å·²åˆ‡æ¢ï¼Œä»¥ä¾¿ä½ å¯ä»¥çœ‹åˆ° Playground é¡µé¢åˆ—è¡¨ï¼š

![image-20221004153833275](https://raw.githubusercontent.com/LLLLLayer/picture-bed/main/img/Kodeco/image-20221004153833275.png)

1. æ¥ä¸‹æ¥ï¼ŒæŸ¥çœ‹çª—å£çš„å³ä¸Šè§’ã€‚ ä½ å°†çœ‹åˆ°è§†å›¾æ§ä»¶ï¼š

![image-20221004153927958](https://raw.githubusercontent.com/LLLLLayer/picture-bed/main/img/Kodeco/image-20221004153927958.png)

ä½¿ç”¨ Live View æ˜¾ç¤º editorã€‚ è¿™å°†æ˜¾ç¤ºä½ åœ¨ä»£ç ä¸­æ„å»ºçš„åºåˆ—çš„å®æ—¶è§†å›¾ã€‚

1. æ˜¾ç¤ºè°ƒè¯•åŒºåŸŸå¯¹äºæœ¬ç« ä¸­çš„å¤§å¤šæ•°ç¤ºä¾‹éƒ½å¾ˆé‡è¦ã€‚ ä½¿ç”¨çª—å£å³ä¸‹è§’çš„ä»¥ä¸‹å›¾æ ‡æˆ–ä½¿ç”¨é”®ç›˜å¿«æ·é”® Command-Shift-Y åˆ‡æ¢è°ƒè¯•åŒºåŸŸï¼š

![image-20221004154059399](https://raw.githubusercontent.com/LLLLLayer/picture-bed/main/img/Kodeco/image-20221004154059399.png)

**Playground ä¸å·¥ä½œï¼Ÿ**

æœ‰æ—¶ Xcode å¯èƒ½ä¼šæ— æ³•æ­£å¸¸è¿è¡Œä½ çš„ Playgroundã€‚ å¦‚æœä½ é‡åˆ°è¿™ç§æƒ…å†µï¼Œè¯·åœ¨ Xcode ä¸­æ‰“å¼€ Preferences å¯¹è¯æ¡†å¹¶é€‰æ‹© Locations é€‰é¡¹å¡ã€‚ å•å‡» Derived Data ä½ç½®æ—è¾¹çš„ç®­å¤´ï¼Œåœ¨ä¸‹é¢çš„å±å¹•æˆªå›¾ä¸­ç”¨çº¢è‰²åœ†åœˆ 1 è¡¨ç¤ºã€‚ å®ƒåœ¨ Finder ä¸­æ˜¾ç¤º DerivedData æ–‡ä»¶å¤¹ã€‚

![image-20221004154205292](https://raw.githubusercontent.com/LLLLLayer/picture-bed/main/img/Kodeco/image-20221004154205292.png)

é€€å‡º Xcodeï¼Œå°† DerivedData æ–‡ä»¶å¤¹ç§»è‡³åƒåœ¾ç®±ï¼Œç„¶åå†æ¬¡å¯åŠ¨ Xcodeã€‚ä½ çš„ Playground ç°åœ¨åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼

#### ç§»åŠ¨æ—¶é—´(Shifting time)

æœ€åŸºæœ¬çš„æ—¶é—´æ“çºµæ“ä½œç¬¦ä¼šå»¶è¿Ÿæ¥è‡ªå‘å¸ƒè€…çš„å€¼ï¼Œä»¥ä¾¿ä½ çœ‹åˆ°å®ƒä»¬æ¯”å®ƒä»¬å®é™…å‡ºç°çš„æ—¶é—´æ™šã€‚

`delay(for:tolerance:scheduler:options)` æ“ä½œç¬¦å¯¹æ•´ä¸ªå€¼åºåˆ—è¿›è¡Œæ—¶ç§»ï¼šæ¯æ¬¡ä¸Šæ¸¸å‘å¸ƒè€…å‘å‡ºä¸€ä¸ªå€¼æ—¶ï¼Œå»¶è¿Ÿéƒ½ä¼šå°†å…¶ä¿ç•™ä¸€æ®µæ—¶é—´ï¼Œç„¶ååœ¨ä½ è¦æ±‚çš„å»¶è¿Ÿååœ¨ä½ çš„è°ƒåº¦ç¨‹åºä¸Šå‘å‡ºå®ƒæŒ‡å®šçš„ã€‚

æ‰“å¼€ delay Playground é¡µé¢ã€‚ä½ å°†çœ‹åˆ°çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼Œä½ ä¸ä»…å¯¼å…¥äº† Combine æ¡†æ¶ï¼Œè¿˜å¯¼å…¥äº† SwiftUIï¼è¿™ä¸ªåŠ¨ç”»æ¸¸ä¹åœºæ˜¯ä½¿ç”¨ SwiftUI å’Œ Combine æ„å»ºçš„ã€‚å½“ä½ æƒ³æ¢ç´¢æ—¶ï¼Œæœ€å¥½ä»”ç»†é˜…è¯» Sources æ–‡ä»¶å¤¹ä¸­çš„ä»£ç ã€‚

ä½†é¦–å…ˆè¦åšçš„äº‹æƒ…ã€‚é¦–å…ˆå®šä¹‰å‡ ä¸ªå¸¸é‡ï¼Œç¨åä½ å¯ä»¥å¯¹å…¶è¿›è¡Œè°ƒæ•´ï¼š

```
let valuesPerSecond = 1.0let delayInSeconds = 1.5
```

ä½ å°†åˆ›å»ºä¸€ä¸ªæ¯ç§’å‘å‡ºä¸€ä¸ªå€¼çš„å‘å¸ƒè€…ï¼Œç„¶åå°†å…¶å»¶è¿Ÿ 1.5 ç§’å¹¶åŒæ—¶æ˜¾ç¤ºä¸¤ä¸ªæ—¶é—´çº¿ä»¥è¿›è¡Œæ¯”è¾ƒã€‚ å®Œæˆæ­¤é¡µé¢ä¸Šçš„ä»£ç åï¼Œä½ å°†èƒ½å¤Ÿè°ƒæ•´å¸¸é‡å¹¶åœ¨æ—¶é—´è½´ä¸­æŸ¥çœ‹ç»“æœã€‚

æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä½ éœ€è¦çš„å‘å¸ƒè€…ï¼š

```
// 1let sourcePublisher = PassthroughSubject<Date, Never>()â€‹// 2let delayedPublisher = sourcePublisher.delay(for: .seconds(delayInSeconds), scheduler: DispatchQueue.main)â€‹// 3let subscription = Timer    .publish(every: 1.0 / valuesPerSecond, on: .main, in: .common)    .autoconnect()    .subscribe(sourcePublisher)
```

åˆ†è§£è¿™æ®µä»£ç ï¼š

1. sourcePublisher æ˜¯ä¸€ä¸ª PassthroughSubjectï¼Œä½ å°†æä¾› Timer å‘å‡ºçš„ Dateã€‚ å€¼çš„ç±»å‹åœ¨è¿™é‡Œå¹¶ä¸é‡è¦ã€‚ ä½ åªå…³å¿ƒå‘å¸ƒè€…å‘å‡ºå€¼æ—¶ä»¥åŠå»¶è¿Ÿåæ˜¾ç¤ºå€¼æ—¶çš„æ˜ åƒã€‚
2. delayPublisher å°†å»¶è¿Ÿæ¥è‡ª sourcePublisher çš„å€¼å¹¶å°†å®ƒä»¬å‘é€åˆ°ä¸»è°ƒåº¦ç¨‹åºã€‚ä½ å°†åæ–‡äº†è§£æ‰€æœ‰å…³äºè°ƒåº¦å™¨çš„çŸ¥è¯†ã€‚ ç°åœ¨ï¼ŒæŒ‡å®šå€¼å¿…é¡»åœ¨ä¸»é˜Ÿåˆ—ä¸­ç»“æŸï¼Œå‡†å¤‡å¥½æ˜¾ç¤ºä»¥ä½¿ç”¨å®ƒä»¬ã€‚
3. åˆ›å»ºä¸€ä¸ªåœ¨ä¸»çº¿ç¨‹ä¸Šæ¯ç§’ä¼ é€’ä¸€ä¸ªå€¼çš„è®¡æ—¶å™¨ã€‚ ç«‹å³ä½¿ç”¨ `autoconnect()` å¯åŠ¨å®ƒï¼Œå¹¶é€šè¿‡ sourcePublisher æä¾›å®ƒå‘å‡ºçš„å€¼ã€‚

> æ³¨æ„ï¼šè¿™ä¸ª Timer æ˜¯ Foundation Timerç±»çš„ç»„åˆæ‰©å±•ã€‚ å®ƒéœ€è¦ä¸€ä¸ª RunLoop å’Œ RunLoop.Modeï¼Œè€Œä¸æ˜¯ä½ å¯èƒ½æœŸæœ›çš„ DispatchQueueã€‚ ä½ å°†åœ¨åæ–‡äº†è§£æœ‰ Timer çš„ä¿¡æ¯ã€‚ æ­¤å¤–ï¼ŒTimer æ˜¯å¯è¿æ¥çš„å‘å¸ƒè€…ç±»çš„ä¸€éƒ¨åˆ†ã€‚ è¿™æ„å‘³ç€å®ƒä»¬éœ€è¦åœ¨å¼€å§‹å‘å‡ºå€¼ä¹‹å‰è¢«è¿æ¥ã€‚ä½ ä½¿ç”¨ autoconnect() åœ¨ç¬¬ä¸€æ¬¡è®¢é˜…æ—¶ç«‹å³è¿æ¥ã€‚

ä½ å°†åˆ›å»ºä¸¤ä¸ªè§†å›¾ï¼Œè¿™ä¸¤ä¸ªè§†å›¾å°†è®©ä½ å¯è§†åŒ–äº‹ä»¶ã€‚ å°†æ­¤ä»£ç æ·»åŠ åˆ°ä½ çš„ Playgroundï¼š

```
// 4let sourceTimeline = TimelineView(title: "Emitted values (\(valuesPerSecond) per sec.):")// 5let delayedTimeline = TimelineView(title: "Delayed values (with a \(delayInSeconds)s delay):")// 6let view = VStack(spacing: 50) {    sourceTimeline    delayedTimeline}// 7PlaygroundPage.current.liveView = UIHostingController(rootView: view.frame(width: 375, height: 600))
```

åœ¨æ­¤ä»£ç ä¸­ï¼š

1. åˆ›å»ºä¸€ä¸ªå°†æ˜¾ç¤ºæ¥è‡ª Timer çš„å€¼çš„ TimelineViewã€‚ TimelineView æ˜¯ä¸€ä¸ª SwiftUI è§†å›¾ï¼Œå®ƒçš„ä»£ç å¯ä»¥åœ¨ Sources/Views.swift æ‰¾åˆ°ã€‚
2. åˆ›å»ºå¦ä¸€ä¸ª TimelineView æ¥æ˜¾ç¤ºå»¶è¿Ÿå€¼ã€‚
3. åˆ›å»ºä¸€ä¸ªç®€å•çš„ SwiftUI å‚ç›´å †æ ˆï¼Œä»¥å°†ä¸¤ä¸ªæ—¶é—´çº¿ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ˜¾ç¤ºã€‚
4. è®¾ç½®æ­¤ Playground é¡µé¢çš„å®æ—¶è§†å›¾ã€‚ `frame(widht:height:)` ä¿®é¥°ç¬¦åªæ˜¯ç”¨æ¥å¸®åŠ©ä¸º Xcode çš„é¢„è§ˆè®¾ç½®ä¸€ä¸ªå›ºå®šçš„æ¡†æ¶ã€‚

åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä½ ä¼šåœ¨å±å¹•ä¸Šçœ‹åˆ°ä¸¤æ¡ç©ºçš„æ—¶é—´çº¿ã€‚ ä½ ç°åœ¨éœ€è¦å‘ä»–ä»¬æä¾›æ¥è‡ªæ¯ä¸ªå‘å¸ƒè€…çš„å€¼ï¼ å°†æ­¤æœ€ç»ˆä»£ç æ·»åŠ åˆ°æ“åœºï¼š

```
sourcePublisher.displayEvents(in: sourceTimeline)delayedPublisher.displayEvents(in: delayedTimeline)
```

åœ¨æœ€åä¸€æ®µä»£ç ä¸­ï¼Œä½ å°†æºå‘å¸ƒè€…å’Œå»¶è¿Ÿå‘å¸ƒè€…è¿æ¥åˆ°å„è‡ªçš„æ—¶é—´çº¿ä»¥æ˜¾ç¤ºäº‹ä»¶ã€‚

ä¿å­˜è¿™äº›æºä»£ç æ›´æ”¹åï¼ŒXcode å°†é‡æ–°ç¼–è¯‘ Playgroundï¼ŒæŸ¥çœ‹å®æ—¶è§†å›¾çª—æ ¼ã€‚

![image-20221004160336680](https://raw.githubusercontent.com/LLLLLayer/picture-bed/main/img/Kodeco/image-20221004160336680.png)

ä½ ä¼šçœ‹åˆ°ä¸¤ä¸ªæ—¶é—´çº¿ã€‚ é¡¶éƒ¨æ—¶é—´çº¿æ˜¾ç¤º Timer å‘å‡ºçš„å€¼ã€‚ åº•éƒ¨æ—¶é—´çº¿æ˜¾ç¤ºç›¸åŒçš„å»¶è¿Ÿçš„å€¼ã€‚ åœ†åœˆå†…çš„æ•°å­—åæ˜ äº†å‘å‡ºçš„å€¼çš„æ•°é‡ï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„å®é™…å†…å®¹ã€‚

#### æ”¶é›†å€¼(Collecting values)

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦ä»¥æŒ‡å®šçš„æ—¶é—´é—´éš”ä»å‘å¸ƒè€…é‚£é‡Œæ”¶é›†å€¼ã€‚è¿™æ˜¯ä¸€ç§å¾ˆæœ‰ç”¨çš„ç¼“å†²å½¢å¼ã€‚ ä¾‹å¦‚ï¼Œå½“ä½ æƒ³è¦åœ¨çŸ­æ—¶é—´å†…å¹³å‡ä¸€ç»„å€¼å¹¶è¾“å‡ºå¹³å‡å€¼æ—¶ã€‚

é€šè¿‡å•å‡»åº•éƒ¨çš„ Next é“¾æ¥æˆ–åœ¨ Project navigator æˆ–è·³è½¬æ ä¸­é€‰æ‹©å®ƒæ¥åˆ‡æ¢åˆ° Collect é¡µé¢ã€‚

ä¸å‰é¢çš„ç¤ºä¾‹ä¸€æ ·ï¼Œä½ å°†ä»ä¸€äº›å¸¸é‡å¼€å§‹ï¼š

```
let valuesPerSecond = 1.0let collectTimeStride = 4
```

å½“ç„¶ï¼Œé˜…è¯»è¿™äº›å¸¸é‡å¯ä»¥è®©ä½ äº†è§£è¿™ä¸€åˆ‡çš„å‘å±•æ–¹å‘ã€‚ ç«‹å³åˆ›å»ºä½ çš„å‘å¸ƒè€…ï¼š

```
// 1let sourcePublisher = PassthroughSubject<Date, Never>()// 2let collectedPublisher = sourcePublisher    .collect(.byTime(DispatchQueue.main, .seconds(collectTimeStride)))
```

ä¸å‰é¢çš„ç¤ºä¾‹ä¸€æ ·ï¼š

1. è®¾ç½®æºå‘å¸ƒè€…â€”â€”ä¸€ä¸ªå°†ä¼ é€’ Timer å‘å‡ºçš„å€¼çš„ `PassthroughSubject`ã€‚
2. åˆ›å»ºä¸€ä¸ª `collectedPublisher`ï¼Œå®ƒä½¿ç”¨ `collect` æ“ä½œç¬¦æ”¶é›†å®ƒåœ¨ `collectTimeStride` è·¨æ­¥æœŸé—´æ¥æ”¶åˆ°çš„å€¼ã€‚ æ“ä½œç¬¦å°†è¿™äº›å€¼ç»„ä½œä¸ºæ•°ç»„å‘é€åˆ°æŒ‡å®šçš„è°ƒåº¦ç¨‹åºï¼š`DispatchQueue.main`ã€‚

> æ³¨æ„ï¼šä½ å¯èƒ½è¿˜è®°å¾—åœ¨ç¬¬ 3 èŠ‚â€œè½¬æ¢æ“ä½œç¬¦â€ä¸­å­¦ä¹ äº† collect æ“ä½œç¬¦ï¼Œåœ¨é‚£é‡Œä½ ä½¿ç”¨äº†ä¸€ä¸ªç®€å•çš„æ•°å­—æ¥å®šä¹‰å¦‚ä½•å°†å€¼ç»„åˆåœ¨ä¸€èµ·ã€‚ collect çš„è¿™ç§é‡è½½æ¥å—äº†å¯¹å€¼è¿›è¡Œåˆ†ç»„çš„ç­–ç•¥ï¼› åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŒ‰æ—¶é—´ã€‚

ä½ å°†å†æ¬¡ä½¿ç”¨ Timer å®šæœŸå‘å‡ºå€¼ï¼Œå°±åƒä½ å¯¹å»¶è¿Ÿæ“ä½œç¬¦æ‰€åšçš„é‚£æ ·ï¼š

```
let subscription = Timer    .publish(every: 1.0 / valuesPerSecond, on: .main, in: .common)    .autoconnect()    .subscribe(sourcePublisher)
```

æ¥ä¸‹æ¥ï¼Œåƒå‰é¢çš„ç¤ºä¾‹ä¸€æ ·åˆ›å»ºæ—¶é—´çº¿è§†å›¾ã€‚ ç„¶åå°† Playground çš„å®æ—¶è§†å›¾è®¾ç½®ä¸ºå‚ç›´å †æ ˆï¼Œæ˜¾ç¤ºæºæ—¶é—´è½´å’Œæ”¶é›†å€¼çš„æ—¶é—´è½´ï¼š

```
let sourceTimeline = TimelineView(title: "Emitted values:")let collectedTimeline = TimelineView(title: "Collected values (every \(collectTimeStride)s):")let view = VStack(spacing: 40) {    sourceTimeline    collectedTimeline}PlaygroundPage.current.liveView = UIHostingController(rootView: view.frame(width: 375, height: 600))
```

æœ€åï¼Œå°†æ¥è‡ªä¸¤ä¸ªå‘å¸ƒè€…çš„äº‹ä»¶æä¾›ç»™æ—¶é—´çº¿ï¼š

```
sourcePublisher.displayEvents(in: sourceTimeline)collectedPublisher.displayEvents(in:collectedTimeline)
```

ç°åœ¨çœ‹ä¸€ä¸‹å®æ—¶è§†å›¾ï¼š

![image-20221004162942164](https://raw.githubusercontent.com/LLLLLayer/picture-bed/main/img/Kodeco/image-20221004162942164.png)

ä½ ä¼šçœ‹åˆ°å€¼å®šæœŸå‡ºç°åœ¨ Emitted values æ—¶é—´è½´ä¸Šã€‚ åœ¨å®ƒä¸‹æ–¹ï¼Œä½ ä¼šçœ‹åˆ°æ”¶é›†çš„å€¼æ—¶é—´çº¿æ¯å››ç§’æ˜¾ç¤ºä¸€ä¸ªå€¼ã€‚ ä½†å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ

ä½ å¯èƒ½å·²ç»çŒœåˆ°ï¼Œè¯¥å€¼æ˜¯æœ€è¿‘å››ç§’å†…æ”¶åˆ°çš„ä¸€ç»„å€¼ã€‚ ä½ å¯ä»¥æ”¹è¿›æ˜¾ç¤ºä»¥æŸ¥çœ‹å…¶ä¸­çš„å®é™…å†…å®¹ï¼ è¿”å›åˆ°åˆ›å»º `collectedPublisher` å¯¹è±¡çš„è¡Œã€‚ åœ¨å…¶ä¸‹æ–¹æ·»åŠ å¯¹ flatMap æ“ä½œç¬¦çš„ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
let collectedPublisher = sourcePublisher    .collect(.byTime(DispatchQueue.main, .seconds(collectTimeStride)))    .flatMap { dates in dates.publisher }
```

ä½ è¿˜è®°å¾—ä½ åœ¨ç¬¬ 3 èŠ‚â€œè½¬æ¢æ“ä½œç¬¦â€ä¸­å­¦åˆ°çš„ flatMap å—ï¼Ÿ ä½ åœ¨è¿™é‡Œå¾ˆå¥½åœ°åˆ©ç”¨äº†å®ƒï¼šæ¯æ¬¡ collect å‘å‡ºä¸€ç»„å®ƒæ”¶é›†çš„å€¼æ—¶ï¼ŒflatMap å†æ¬¡å°†å…¶åˆ†è§£ä¸ºå•ä¸ªå€¼ï¼Œä½†ä¼šç«‹å³ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å‘å‡ºã€‚ å®ƒä½¿ç”¨ Collection çš„ publisher extensionï¼Œå°†ä¸€ç³»åˆ—å€¼è½¬æ¢ä¸ºå‘å¸ƒè€…ï¼Œç«‹å³å°†åºåˆ—ä¸­çš„æ‰€æœ‰å€¼ä½œä¸ºå•ç‹¬çš„å€¼å‘å‡ºã€‚

ç°åœ¨ï¼Œçœ‹çœ‹å®ƒå¯¹æ—¶é—´è½´çš„å½±å“ï¼š

![image-20221004163101662](https://raw.githubusercontent.com/LLLLLayer/picture-bed/main/img/Kodeco/image-20221004163101662.png)

ä½ ç°åœ¨å¯ä»¥çœ‹åˆ°ï¼Œæ¯å››ç§’ collect ä¼šå‘å‡ºä¸€ä¸ªåœ¨æœ€åä¸€ä¸ªæ—¶é—´é—´éš”å†…æ”¶é›†çš„å€¼æ•°ç»„ã€‚

`collect(_:options:)` æ“ä½œç¬¦æä¾›çš„ç¬¬äºŒä¸ªé€‰é¡¹å…è®¸ä½ å®šæœŸæ”¶é›†å€¼ã€‚å®ƒè¿˜å…è®¸ä½ é™åˆ¶æ”¶é›†çš„å€¼çš„æ•°é‡ã€‚

ç•™åœ¨åŒä¸€ä¸ªæ”¶é›†é¡µé¢ä¸Šï¼Œå¹¶åœ¨é¡¶éƒ¨çš„ collectTimeStride æ­£ä¸‹æ–¹æ·»åŠ ä¸€ä¸ªæ–°å¸¸é‡ï¼š

```
let collectMaxCount = 2
```

æ¥ä¸‹æ¥ï¼Œåœ¨collectedPublisherä¹‹ååˆ›å»ºä¸€ä¸ªæ–°çš„å‘å¸ƒè€…ï¼š

```
let collectedPublisher2 = sourcePublisher    .collect(.byTimeOrCount(DispatchQueue.main,                            .seconds(collectTimeStride),                            collectMaxCount))    .flatMap { dates in dates.publisher }
```

è¿™ä¸€æ¬¡ï¼Œä½ ä½¿ç”¨ `.byTimeOrCount(Context, Context.SchedulerTimeType.Stride, Int)` å˜ä½“ä¸€æ¬¡æœ€å¤šæ”¶é›† collectMaxCount å€¼ã€‚

åœ¨collectedTimeline ä¹‹é—´ä¸ºç¬¬äºŒä¸ªcollect å‘å¸ƒè€…æ·»åŠ ä¸€ä¸ªæ–°çš„ TimelineView å’Œ VStackï¼š

```
let collectedTimeline2 = TimelineView(title: "Collected values (at most \(collectMaxCount) every \(collectTimeStride)s):")â€‹let view = VStack(spacing: 40) {    sourceTimeline    collectedTimeline    collectedTimeline2}
```

æœ€åï¼Œé€šè¿‡åœ¨ Playground æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œç¡®ä¿å®ƒåœ¨æ—¶é—´è½´ä¸­æ˜¾ç¤ºå®ƒå‘å‡ºçš„äº‹ä»¶ï¼š

```
collectedPublisher2.displayEvents(in:collectedTimeline2)
```

ç°åœ¨ï¼Œè®©è¿™ä¸ªæ—¶é—´çº¿è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œè¿™æ ·ä½ å°±å¯ä»¥çœ‹åˆ°ä¸åŒä¹‹å¤„ï¼š

![image-20221004164508977](https://raw.githubusercontent.com/LLLLLayer/picture-bed/main/img/Kodeco/image-20221004164508977.png)

ä½ å¯ä»¥åœ¨æ­¤å¤„çœ‹åˆ°ç¬¬äºŒä¸ªæ—¶é—´çº¿å°†å…¶é›†åˆä¸€æ¬¡é™åˆ¶ä¸ºä¸¤ä¸ªå€¼ï¼Œè¿™æ˜¯ collectMaxCount å¸¸é‡æ‰€è¦æ±‚çš„ã€‚

#### æ¨è¿Ÿäº‹ä»¶

åœ¨ç¼–ç ç”¨æˆ·ç•Œé¢æ—¶ï¼Œä½ ç»å¸¸å¤„ç†æ–‡æœ¬å­—æ®µã€‚ä½¿ç”¨ç»„åˆå°†æ–‡æœ¬å­—æ®µå†…å®¹è¿æ¥åˆ°æ“ä½œæ˜¯ä¸€é¡¹å¸¸è§ä»»åŠ¡ã€‚ ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›å‘é€ä¸€ä¸ªæœç´¢ URL è¯·æ±‚ï¼Œè¯¥è¯·æ±‚è¿”å›ä¸åœ¨æ–‡æœ¬å­—æ®µä¸­é”®å…¥çš„å†…å®¹åŒ¹é…çš„é¡¹ç›®åˆ—è¡¨ã€‚

ä½†æ˜¯ï¼Œå½“ç„¶ï¼Œä½ ä¸å¸Œæœ›æ¯æ¬¡ç”¨æˆ·è¾“å…¥ä¸€ä¸ªå­—æ¯æ—¶éƒ½å‘é€è¯·æ±‚ï¼ ä½ éœ€è¦æŸç§æœºåˆ¶æ¥å¸®åŠ©ä»…åœ¨ç”¨æˆ·å®Œæˆä¸€æ®µæ—¶é—´çš„è¾“å…¥æ—¶æ‰èƒ½å¤Ÿè¯†åˆ«è¾“å…¥çš„æ–‡æœ¬ã€‚

Combine æä¾›äº†ä¸¤ä¸ªå¯ä»¥åœ¨è¿™é‡Œä¸ºä½ æä¾›å¸®åŠ©çš„æ“ä½œç¬¦ï¼šé˜²æŠ–(Debounce)å’ŒèŠ‚æµ(Throttle)ã€‚

**é˜²æŠ–(Debounce)**

åˆ‡æ¢åˆ°åä¸º Debounce çš„ Playground é¡µé¢ã€‚ é¦–å…ˆåˆ›å»ºå‡ ä¸ªå‘å¸ƒè€…ï¼š

```
// 1let subject = PassthroughSubject<String, Never>()// 2let debounced = subject    .debounce(for: .seconds(1.0), scheduler: DispatchQueue.main)// 3    .share()
```

åœ¨æ­¤ä»£ç ä¸­ï¼š

1. åˆ›å»ºä¸€ä¸ªå‘å‡ºå­—ç¬¦ä¸²çš„å‘å¸ƒè€…ã€‚
2. ä½¿ç”¨ debounce ç­‰å¾…å¯¹è±¡å‘å°„ä¸€ç§’é’Ÿã€‚ ç„¶åï¼Œå®ƒå°†å‘é€åœ¨è¯¥ä¸€ç§’é—´éš”å†…å‘é€çš„æœ€åä¸€ä¸ªå€¼ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚ è¿™å…·æœ‰å…è®¸æ¯ç§’æœ€å¤šå‘é€ä¸€ä¸ªå€¼çš„æ•ˆæœã€‚
3. ä½ å°†å¤šæ¬¡è®¢é˜… debouncedã€‚ ä¸ºäº†ä¿è¯ç»“æœçš„ä¸€è‡´æ€§ï¼Œä½ ä½¿ç”¨ share() åˆ›å»ºå•ä¸ªè®¢é˜…ç‚¹ï¼Œè¿™å°†åŒæ—¶å‘æ‰€æœ‰è®¢é˜…è€…æ˜¾ç¤ºç›¸åŒçš„ç»“æœã€‚

> æ³¨æ„ï¼šæ·±å…¥æ¢è®¨ share() æ“ä½œç¬¦è¶…å‡ºäº†æœ¬ç« çš„èŒƒå›´ã€‚è¯·è®°ä½ï¼Œå½“éœ€è¦å¯¹å‘å¸ƒè€…çš„å•ä¸ªè®¢é˜…æ¥å‘å¤šä¸ªè®¢é˜…è€…æä¾›ç›¸åŒçš„ç»“æœæ—¶ï¼Œå®ƒä¼šå¾ˆæœ‰å¸®åŠ©ã€‚ ä½ å°†åœ¨åæ–‡â€œèµ„æºç®¡ç†â€ä¸­äº†è§£æœ‰å…³ share() çš„æ›´å¤šä¿¡æ¯ã€‚

å¯¹äºæ¥ä¸‹æ¥çš„å‡ ä¸ªç¤ºä¾‹ï¼Œä½ å°†ä½¿ç”¨ä¸€ç»„æ•°æ®æ¥æ¨¡æ‹Ÿç”¨æˆ·åœ¨æ–‡æœ¬å­—æ®µä¸­é”®å…¥æ–‡æœ¬ã€‚ ä¸è¦è¾“å…¥è¿™ä¸ªâ€”â€”å®ƒå·²ç»åœ¨ Sources/Data.swift ä¸­ä¸ºä½ å®ç°äº†ï¼š

```
public let typingHelloWorld: [(TimeInterval, String)] = [    (0.0, "H"),    (0.1, "He"),    (0.2, "Hel"),    (0.3, "Hell"),    (0.5, "Hello"),    (0.6, "Hello "),    (2.0, "Hello W"),    (2.1, "Hello Wo"),    (2.2, "Hello Wor"),    (2.4, "Hello Worl"),    (2.5, "Hello World")]
```

æ¨¡æ‹Ÿç”¨æˆ·åœ¨ 0.0 ç§’å¼€å§‹æ‰“å­—ï¼Œåœ¨ 0.6 ç§’åæš‚åœï¼Œåœ¨ 2.0 ç§’æ¢å¤æ‰“å­—ã€‚

> æ³¨æ„ï¼šä½ å°†åœ¨ Debug åŒºåŸŸä¸­çœ‹åˆ°çš„æ—¶é—´å€¼å¯èƒ½ä¼šåç§» 0.1 æˆ– 0.2 ç§’ã€‚ ç”±äºä½ å°†ä½¿ç”¨ DispatchQueue.asyncAfter() åœ¨ä¸»é˜Ÿåˆ—ä¸Šå‘å‡ºå€¼ï¼Œå› æ­¤å¯ä»¥ä¿è¯å€¼ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”ï¼Œä½†å¯èƒ½ä¸å®Œå…¨ç¬¦åˆä½ çš„è¦æ±‚ã€‚

åœ¨ Playground çš„ Debounce é¡µé¢ä¸­ï¼Œåˆ›å»ºä¸¤ä¸ªæ—¶é—´çº¿æ¥å¯è§†åŒ–äº‹ä»¶ï¼Œå¹¶å°†å®ƒä»¬è¿æ¥åˆ°ä¸¤ä¸ªå‘å¸ƒè€…ï¼š

```
let subjectTimeline = TimelineView(title: "Emitted values")let debouncedTimeline = TimelineView(title: "Debounced values")let view = VStack(spacing: 100) {    subjectTimeline    debouncedTimeline}PlaygroundPage.current.liveView = UIHostingController(rootView: view.frame(width: 375, height: 600))subject.displayEvents(in: subjectTimeline)debounced.displayEvents(in: debouncedTimeline)
```

ä½ ç°åœ¨å·²ç»ç†Ÿæ‚‰äº†è¿™ä¸ª Playground ç»“æ„ï¼Œä½ å¯ä»¥åœ¨å±å¹•ä¸Šå †å æ—¶é—´çº¿å¹¶å°†å®ƒä»¬è¿æ¥åˆ°å‘å¸ƒè€…ä»¥è¿›è¡Œäº‹ä»¶æ˜¾ç¤ºã€‚

è¿™ä¸€æ¬¡ï¼Œä½ å°†åšæ›´å¤šçš„äº‹æƒ…ï¼šæ‰“å°æ¯ä¸ªå‘å¸ƒè€…å‘å‡ºçš„å€¼ï¼Œä»¥åŠå®ƒä»¬å‡ºç°çš„æ—¶é—´ï¼ˆè‡ªå¼€å§‹ä»¥æ¥ï¼‰ã€‚ è¿™å°†å¸®åŠ©ä½ å¼„æ¸…æ¥šå‘ç”Ÿäº†ä»€ä¹ˆã€‚

æ·»åŠ æ­¤ä»£ç ï¼š

```
let subscription1 = subject    .sink { string in        print("+\(deltaTime)s: Subject emitted: \(string)")    }let subscription2 = debounced    .sink { string in        print("+\(deltaTime)s: Debounced emitted: \(string)")    }
```

æ¯ä¸ªè®¢é˜…éƒ½ä¼šæ‰“å°å®ƒæ”¶åˆ°çš„å€¼ä»¥åŠè‡ªå¼€å§‹ä»¥æ¥çš„æ—¶é—´ã€‚ deltaTime æ˜¯åœ¨ Sources/DeltaTime.swift ä¸­å®šä¹‰çš„åŠ¨æ€å…¨å±€å˜é‡ï¼Œå®ƒæ ¼å¼åŒ–è‡ª Playground å¼€å§‹è¿è¡Œä»¥æ¥çš„æ—¶é—´å·®ã€‚

ç°åœ¨ä½ éœ€è¦ä¸ºä½ çš„ä¸»é¢˜æä¾›æ•°æ®ã€‚ è¿™ä¸€æ¬¡ï¼Œä½ å°†ä½¿ç”¨æ¨¡æ‹Ÿç”¨æˆ·é”®å…¥æ–‡æœ¬çš„é¢„åˆ¶æ•°æ®æºã€‚ å…¨éƒ¨åœ¨ Sources/Data.swift ä¸­å®šä¹‰ï¼Œä½ å¯ä»¥éšæ„ä¿®æ”¹ã€‚ çœ‹ä¸€çœ‹ï¼Œä½ ä¼šå‘ç°å®ƒæ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥â€œHello Worldâ€è¿™ä¸ªè¯ã€‚

å°†æ­¤ä»£ç æ·»åŠ åˆ° Playground é¡µé¢çš„æœ«å°¾ï¼š

```
subject.feed(with: typingHelloWorld)
```

feed(with:) æ–¹æ³•è·å–ä¸€ä¸ªæ•°æ®é›†å¹¶ä»¥é¢„å®šä¹‰çš„æ—¶é—´é—´éš”å°†æ•°æ®å‘é€åˆ°ç»™å®šçš„ä¸»é¢˜ã€‚ ç”¨äºæ¨¡æ‹Ÿå’Œæ¨¡æ‹Ÿæ•°æ®è¾“å…¥çš„ä¾¿æ·å·¥å…·ï¼ å½“ä½ ä¸ºä»£ç ç¼–å†™æµ‹è¯•æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›ä¿ç•™è¿™ä¸€ç‚¹ï¼Œå› ä¸ºä½ å°†ç¼–å†™æµ‹è¯•ï¼Œä¸æ˜¯å—ï¼Ÿ

ç°åœ¨çœ‹çœ‹ç»“æœï¼š

![image-20221006012419994](https://raw.githubusercontent.com/LLLLLayer/picture-bed/main/img/Kodeco/image-20221006012419994.png)

ä½ ä¼šåœ¨é¡¶éƒ¨çœ‹åˆ°å‘å‡ºçš„å€¼ï¼Œæ€»å…±æœ‰ 11 ä¸ªå­—ç¬¦ä¸²è¢«æ¨é€åˆ° sourcePublisherã€‚ ä½ å¯ä»¥çœ‹åˆ°ç”¨æˆ·åœ¨è¿™ä¸¤ä¸ªè¯ä¹‹é—´åœé¡¿äº†ä¸€ä¸‹ã€‚ è¿™æ˜¯ debounce å‘å‡ºæ•è·çš„å†…å®¹çš„æ—¶é—´ã€‚

ä½ å¯ä»¥é€šè¿‡æŸ¥çœ‹æ˜¾ç¤ºæ‰“å°çš„è°ƒè¯•åŒºåŸŸæ¥ç¡®è®¤è¿™ä¸€ç‚¹ï¼š

```
+0.0s: Subject emitted: H+0.1s: Subject emitted: He+0.2s: Subject emitted: Hel+0.3s: Subject emitted: Hell+0.5s: Subject emitted: Hello+0.6s: Subject emitted: Hello +1.6s: Debounced emitted: Hello +2.1s: Subject emitted: Hello W+2.1s: Subject emitted: Hello Wo+2.4s: Subject emitted: Hello Wor+2.4s: Subject emitted: Hello Worl+2.7s: Subject emitted: Hello World+3.7s: Debounced emitted: Hello World
```

ç”¨æˆ·åœ¨ 0.6 ç§’æ—¶æš‚åœå¹¶ä»…åœ¨ 2.1 ç§’æ—¶æ¢å¤è¾“å…¥ã€‚å®ƒåœ¨ 1.6 ç§’æ—¶ï¼Œå‘å‡ºæœ€æ–°æ¥æ”¶åˆ°çš„å€¼ã€‚åœ¨ 2.7 ç§’æ‰“å­—ç»“æŸï¼Œåœ¨ä¸€ç§’åçš„ 3.7 ç§’ç»“æŸæ—¶å‘å‡ºæœ€æ–°æ¥æ”¶åˆ°çš„å€¼ã€‚

> æ³¨æ„ï¼šè¦æ³¨æ„çš„ä¸€ä»¶äº‹æ˜¯å‘å¸ƒè€…çš„å®Œæˆäº‹ä»¶ã€‚å¦‚æœä½ çš„å‘å¸ƒè€…åœ¨å‘å‡ºæœ€åä¸€ä¸ªå€¼ä¹‹åç«‹å³å®Œæˆï¼Œä¸”åœ¨ä¸ºé˜²æŠ–é…ç½®çš„æ—¶é—´ä¹‹å‰ï¼Œä½ å°†æ°¸è¿œä¸ä¼šçœ‹åˆ°å»æŠ–åŠ¨å‘å¸ƒè€…ä¸­çš„æœ€åä¸€ä¸ªå€¼ï¼

**èŠ‚æµ(Throttle)**

debounce å…è®¸çš„å»¶è¿Ÿæ¨¡å¼éå¸¸æœ‰ç”¨ï¼ŒCombine æä¾›äº†ä¸€ä¸ªç›¸å…³çš„æ“ä½œï¼š`throttle(for:scheduler:latest:)`ã€‚ å®ƒéå¸¸æ¥è¿‘é˜²æŠ–ã€‚

åˆ‡æ¢åˆ° Playground ä¸­çš„ Throttle é¡µé¢å¹¶å¼€å§‹ç¼–ç ã€‚ é¦–å…ˆï¼Œä½ éœ€è¦ä¸€ä¸ªå¸¸é‡ï¼Œåƒå¾€å¸¸ä¸€æ ·ï¼š

```
let throttleDelay = 1.0â€‹// 1let subject = PassthroughSubject<String, Never>()â€‹// 2let throttled = subject    .throttle(for: .seconds(throttleDelay), scheduler: DispatchQueue.main, latest: false)// 3    .share()
```

åˆ†è§£è¿™æ®µä»£ç ï¼š

1. æºå‘å¸ƒè€…å°†å‘å‡ºå­—ç¬¦ä¸²ã€‚
2. ç”±äºä½ å°† latest è®¾ç½®ä¸º falseï¼Œå› æ­¤ä½ çš„ throttled subject ç°åœ¨å°†ä»…åœ¨æ¯ä¸ªä¸€ç§’é—´éš”å†…å‘å‡ºä» subject æ¥æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªå€¼ã€‚
3. å’Œä¹‹å‰çš„æ“ä½œç¬¦ debounce ä¸€æ ·ï¼Œåœ¨æ­¤å¤„æ·»åŠ  share() æ“ä½œç¬¦å¯ä»¥ä¿è¯æ‰€æœ‰è®¢é˜…è€…åŒæ—¶ä»èŠ‚æµä¸»é¢˜çœ‹åˆ°ç›¸åŒçš„è¾“å‡ºã€‚

åˆ›å»ºæ—¶é—´çº¿ä»¥å¯è§†åŒ–äº‹ä»¶ï¼Œå¹¶å°†å®ƒä»¬è¿æ¥åˆ°ä¸¤ä¸ªå‘å¸ƒè€…ï¼š

```
let subjectTimeline = TimelineView(title: "Emitted values")let throttledTimeline = TimelineView(title: "Throttled values")let view = VStack(spacing: 100) {    subjectTimeline    throttledTimeline}PlaygroundPage.current.liveView = UIHostingController(rootView: view.frame(width: 375, height: 600))subject.displayEvents(in: subjectTimeline)throttled.displayEvents(in: throttledTimeline)
```

ç°åœ¨ä½ è¿˜æƒ³æ‰“å°æ¯ä¸ªå‘å¸ƒè€…å‘å‡ºçš„å€¼ï¼Œä»¥æ›´å¥½åœ°äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆã€‚ æ·»åŠ æ­¤ä»£ç ï¼š

```
let subscription1 = subject    .sink { string in        print("+\(deltaTime)s: Subject emitted: \(string)")    }let subscription2 = throttled    .sink { string in        print("+\(deltaTime)s: Throttled emitted: \(string)")    }
```

åŒæ ·ï¼Œä½ å°†å‘æºå‘å¸ƒè€…æä¾›æ¨¡æ‹Ÿçš„â€œHello Worldâ€ç”¨æˆ·è¾“å…¥ã€‚ å°†æœ€åä¸€è¡Œæ·»åŠ åˆ°ä½ çš„ Playground é¡µé¢ï¼š

```
subject.feed(with: typingHelloWorld)
```

ä½ ç°åœ¨å¯ä»¥åœ¨å®æ—¶è§†å›¾ä¸­çœ‹åˆ°æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ï¼š

![image-20221006014413453](https://raw.githubusercontent.com/LLLLLayer/picture-bed/main/img/Kodeco/image-20221006014413453.png)

å®ƒçœ‹èµ·æ¥ä¸ä¹‹å‰çš„ debounce è¾“å‡ºæ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚é¦–å…ˆï¼Œä»”ç»†è§‚å¯Ÿä¸¤è€…ã€‚å¯ä»¥çœ‹åˆ°ï¼Œthrottle å‘å‡ºçš„å€¼åœ¨æ—¶é—´ä¸Šç•¥æœ‰ä¸åŒã€‚å…¶æ¬¡ï¼Œä¸ºäº†æ›´å¥½åœ°äº†è§£æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œè¯·æŸ¥çœ‹è°ƒè¯•æ§åˆ¶å°ï¼š

```
+0.0s: Subject emitted: H+0.0s: Throttled emitted: H+0.1s: Subject emitted: He+0.2s: Subject emitted: Hel+0.3s: Subject emitted: Hell+0.5s: Subject emitted: Hello+0.6s: Subject emitted: Hello +1.0s: Throttled emitted: He+2.2s: Subject emitted: Hello W+2.2s: Subject emitted: Hello Wo+2.2s: Subject emitted: Hello Wor+2.4s: Subject emitted: Hello Worl+2.7s: Subject emitted: Hello World+3.0s: Throttled emitted: Hello W
```

è¿™æ˜æ˜¾ä¸ä¸€æ ·ï¼ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼š

* å½“å¯¹è±¡å‘å‡ºå®ƒçš„ç¬¬ä¸€ä¸ªå€¼æ—¶ï¼ŒThrottle ç«‹å³è½¬å‘å®ƒã€‚ç„¶åï¼Œå®ƒå¼€å§‹é™åˆ¶è¾“å‡ºã€‚
* åœ¨ 1.0 ç§’æ—¶ï¼ŒThrottle å‘å‡ºâ€œHeâ€ã€‚è¯·è®°ä½ï¼Œä½ è¦æ±‚å®ƒåœ¨ä¸€ç§’é’Ÿåå‘ä½ å‘é€ç¬¬ä¸€ä¸ªå€¼ï¼ˆè‡ªæœ€åä¸€ä¸ªå€¼ï¼‰ã€‚
* åœ¨ 2.2 ç§’æ—¶ï¼Œé”®å…¥æ¢å¤ã€‚å¯ä»¥çœ‹åˆ°æ­¤æ—¶ï¼Œthrottle æ²¡æœ‰å‘å‡ºä»»ä½•ä¸œè¥¿ã€‚è¿™æ˜¯å› ä¸ºæ²¡æœ‰ä»æºå‘å¸ƒè€…é‚£é‡Œæ”¶åˆ°æ–°å€¼ã€‚
* åœ¨ 3.0 ç§’ï¼Œè¾“å…¥å®Œæˆåï¼ŒThrottle å†æ¬¡å¯åŠ¨å¹¶å†æ¬¡è¾“å‡ºç¬¬ä¸€ä¸ªå€¼ï¼Œå³ 2.2 ç§’çš„å€¼ã€‚

åœ¨é‚£é‡Œä½ æœ‰é˜²æŠ–åŠ¨å’Œæ²¹é—¨èŠ‚æµçš„æ ¹æœ¬åŒºåˆ«ï¼š

* é˜²æŠ–ç­‰å¾…å®ƒæ¥æ”¶åˆ°çš„å€¼æš‚åœï¼Œç„¶ååœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”åå‘å‡ºæœ€æ–°çš„å€¼ã€‚
* èŠ‚æµç­‰å¾…æŒ‡å®šçš„æ—¶é—´é—´éš”ï¼Œç„¶åå‘å‡ºå®ƒåœ¨è¯¥æ—¶é—´é—´éš”å†…æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªæˆ–æœ€æ–°çš„å€¼ã€‚å®ƒä¸å…³å¿ƒæš‚åœã€‚

è¦æŸ¥çœ‹å°† latest æ›´æ”¹ä¸º true æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œè¯·å°†å—é™åˆ¶çš„å‘å¸ƒè€…çš„è®¾ç½®æ›´æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼š

```
let throttled = subject    .throttle(for: .seconds(throttleDelay), scheduler: DispatchQueue.main, latest: true)
```

ç°åœ¨ï¼Œåœ¨è°ƒè¯•åŒºåŸŸè§‚å¯Ÿç»“æœè¾“å‡ºï¼š

```
+0.0s: Subject emitted: H+0.0s: Throttled emitted: H+0.1s: Subject emitted: He+0.2s: Subject emitted: Hel+0.3s: Subject emitted: Hell+0.5s: Subject emitted: Hello+0.6s: Subject emitted: Hello +1.0s: Throttled emitted: Hello+2.0s: Subject emitted: Hello W+2.3s: Subject emitted: Hello Wo+2.3s: Subject emitted: Hello Wor+2.6s: Subject emitted: Hello Worl+2.6s: Subject emitted: Hello World+3.0s: Throttled emitted: Hello World
```

èŠ‚æµè¾“å‡ºæ°å¥½å‘ç”Ÿåœ¨ 1.0 ç§’å’Œ 3.0 ç§’ï¼Œæ—¶é—´çª—å£ä¸­çš„æœ€æ–°å€¼è€Œä¸æ˜¯æœ€æ—©çš„å€¼ã€‚ å°†æ­¤ä¸å‰é¢ç¤ºä¾‹ä¸­ debounce çš„è¾“å‡ºè¿›è¡Œæ¯”è¾ƒï¼š ... +1.6s: Debounced emitted: Hello ... +3.7s: Debounced emitted: Hello World è¾“å‡ºæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ debounce æ˜¯åœ¨æš‚åœåå»¶è¿Ÿçš„ã€‚

#### è¶…æ—¶(Timing out)

åœ¨æœ¬æ¬¡æ—¶é—´æ“çºµæ“ä½œç¬¦ç»¼è¿°ä¸­ï¼Œä¸‹ä¸€ä¸ªæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ“ä½œç¬¦ï¼šè¶…æ—¶ã€‚å…¶ä¸»è¦ç›®çš„æ˜¯åœ¨è¯­ä¹‰ä¸ŠåŒºåˆ†å®é™…è®¡æ—¶å’Œè¶…æ—¶æ¡ä»¶ã€‚ å› æ­¤ï¼Œå½“è¶…æ—¶æ“ä½œç¬¦è§¦å‘æ—¶ï¼Œå®ƒè¦ä¹ˆå®Œæˆå‘å¸ƒè€…ï¼Œè¦ä¹ˆå‘å‡ºä½ æŒ‡å®šçš„é”™è¯¯ã€‚ åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå‘å¸ƒè€…éƒ½ä¼šç»ˆæ­¢ã€‚

åˆ‡æ¢åˆ° Timeout Playground é¡µé¢ã€‚ é¦–å…ˆæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```
let subject = PassthroughSubject<Void, Never>()â€‹// 1let timedOutSubject = subject.timeout(.seconds(5), scheduler: DispatchQueue.main)
```

timedOutSubject å‘å¸ƒè€…å°†åœ¨ 5 ç§’åè¶…æ—¶ï¼Œä¸Šæ¸¸å‘å¸ƒè€…ä¸ä¼šå‘å‡ºä»»ä½•å€¼ã€‚ è¿™ç§å½¢å¼çš„è¶…æ—¶å¼ºåˆ¶å‘å¸ƒè€…å®Œæˆè€Œæ²¡æœ‰ä»»ä½•å¤±è´¥ã€‚

ä½ ç°åœ¨éœ€è¦æ·»åŠ ä½ çš„æ—¶é—´çº¿ï¼Œä»¥åŠä¸€ä¸ªè®©ä½ è§¦å‘äº‹ä»¶çš„æŒ‰é’®ï¼š

```
let timeline = TimelineView(title: "Button taps")â€‹let view = VStack(spacing: 100) {    // 1    Button(action: { subject.send() }) {        Text("Press me within 5 seconds")    }    timeline}â€‹PlaygroundPage.current.liveView = UIHostingController(rootView: view.frame(width: 375, height: 600))â€‹timedOutSubject.displayEvents(in: timeline)
```

ä½ åœ¨æ—¶é—´çº¿ä¸Šæ–¹æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼ŒæŒ‰ä¸‹è¯¥æŒ‰é’®ä¼šé€šè¿‡æºä¸»é¢˜å‘é€ä¸€ä¸ªæ–°å€¼ã€‚ æ¯æ¬¡æŒ‰ä¸‹æŒ‰é’®æ—¶ï¼Œaction é—­åŒ…éƒ½ä¼šæ‰§è¡Œã€‚

> æ³¨æ„ï¼šä½ æ˜¯å¦æ³¨æ„åˆ°ä½ æ­£åœ¨ä½¿ç”¨å‘å‡º Void å€¼çš„ subjectï¼Ÿ æ˜¯çš„ï¼Œè¿™æ˜¯å®Œå…¨åˆæ³•çš„ï¼ å®ƒè¡¨æ˜å‘ç”Ÿäº†ä»€ä¹ˆäº‹ã€‚ ä½†æ˜¯ï¼Œæ²¡æœ‰ç‰¹åˆ«çš„ä»·å€¼å¯ä»¥æºå¸¦ã€‚ å› æ­¤ï¼Œä½ åªéœ€ä½¿ç”¨ Void ä½œä¸ºå€¼ç±»å‹ã€‚ è¿™æ˜¯å¾ˆå¸¸è§çš„æƒ…å†µï¼ŒSubject æœ‰ä¸€ä¸ªå¸¦æœ‰ send() å‡½æ•°çš„æ‰©å±•ï¼Œå¦‚æœè¾“å‡ºç±»å‹ä¸º Voidï¼Œåˆ™è¯¥å‡½æ•°ä¸æ¥å—ä»»ä½•å‚æ•°ã€‚ è¿™ä½¿ä½ å…äºç¼–å†™ç¬¨æ‹™çš„ subject.send(()) è¯­å¥ï¼

ä½ çš„ Playground é¡µé¢ç°å·²å®Œæˆã€‚ çœ‹ç€å®ƒè¿è¡Œï¼Œä»€ä¹ˆéƒ½ä¸åšï¼šè¶…æ—¶å°†åœ¨äº”ç§’åè§¦å‘å¹¶å®Œæˆå‘å¸ƒè€…ã€‚

ç°åœ¨ï¼Œå†æ¬¡è¿è¡Œå®ƒã€‚ è¿™ä¸€æ¬¡ï¼Œä»¥å°‘äºäº”ç§’çš„é—´éš”æŒç»­æŒ‰ä¸‹æŒ‰é’®ã€‚ å‘å¸ƒè€…æ°¸è¿œä¸ä¼šå®Œæˆï¼Œå› ä¸ºæ²¡æœ‰è¶…æ—¶ã€‚

![image-20221006015755244](https://raw.githubusercontent.com/LLLLLayer/picture-bed/main/img/Kodeco/image-20221006015755244.png)

å½“ç„¶ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç®€å•çš„å®Œæˆä¸€ä¸ªå‘å¸ƒè€…å¹¶ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚ ç›¸åï¼Œä½ éœ€è¦è¶…æ—¶å‘å¸ƒè€…å‘é€å¤±è´¥æ¶ˆæ¯ï¼Œä»¥ä¾¿åœ¨è¿™ç§æƒ…å†µä¸‹å‡†ç¡®åœ°é‡‡å–æªæ–½ã€‚

è½¬åˆ° Playground é¡µé¢çš„é¡¶éƒ¨å¹¶å®šä¹‰ä½ æƒ³è¦çš„é”™è¯¯ç±»å‹ï¼š

```
enum TimeoutError: Error {    case timedOut}
```

æ¥ä¸‹æ¥ï¼Œä¿®æ”¹ subject çš„å®šä¹‰ï¼Œå°†é”™è¯¯ç±»å‹ä» Never æ›´æ”¹ä¸º TimeoutErrorã€‚ä½ çš„ä»£ç åº”å¦‚ä¸‹æ‰€ç¤ºï¼š

```
let subject = PassthroughSubject<Void, TimeoutError>()
```

ç°åœ¨ä½ éœ€è¦å°†è°ƒç”¨ä¿®æ”¹ä¸º `.timeout`ã€‚æ­¤æ“ä½œç¬¦çš„å®Œæ•´ç­¾åæ˜¯ `timeout(_:scheduler:options:customError:)`ã€‚è¿™æ˜¯ä½ æä¾›è‡ªå®šä¹‰é”™è¯¯ç±»å‹çš„æœºä¼šï¼

å°†åˆ›å»º timedOutSubject çš„è¡Œä¿®æ”¹ä¸ºï¼š

```
let timedOutSubject = subject.timeout(.seconds(5),                                      scheduler: DispatchQueue.main,                                      customError: { .timedOut })
```

ç°åœ¨ï¼Œå½“ä½ è¿è¡Œ Playground å¹¶ä¸”äº”ç§’é’Ÿå†…æ²¡æœ‰æŒ‰ä¸‹æŒ‰é’®æ—¶ï¼Œä½ å¯ä»¥çœ‹åˆ° timedOutSubject å‘å‡ºäº†å¤±è´¥ã€‚

![image-20221006020121560](https://raw.githubusercontent.com/LLLLLayer/picture-bed/main/img/Kodeco/image-20221006020121560.png)

#### æµ‹é‡æ—¶é—´(Measuring time)

ä¸ºäº†å®Œæˆæ—¶é—´æ“çºµæ“ä½œç¬¦çš„æ±‡æ€»ï¼Œä½ å°†æŸ¥çœ‹ä¸€ä¸ªä¸æ“çºµæ—¶é—´è€Œåªæ˜¯æµ‹é‡æ—¶é—´çš„ç‰¹å®šæ“ä½œç¬¦ã€‚å½“ä½ éœ€è¦æ‰¾å‡ºå‘å¸ƒè€…å‘å‡ºçš„ä¸¤ä¸ªè¿ç»­å€¼ä¹‹é—´ç»è¿‡çš„æ—¶é—´æ—¶ï¼Œ`measureInterval(using:)` æ“ä½œç¬¦æ˜¯ä½ çš„å·¥å…·ã€‚

åˆ‡æ¢åˆ° MeasureInterval Playground é¡µé¢ã€‚é¦–å…ˆåˆ›å»ºä¸€å¯¹å‘å¸ƒè€…ï¼š

```
let subject = PassthroughSubject<String, Never>()// 1let measureSubject = subject.measureInterval(using: DispatchQueue.main)
```

measureSubject å°†åœ¨ä½ æŒ‡å®šçš„è°ƒåº¦ç¨‹åºä¸Šå‘å‡ºæµ‹é‡å€¼ã€‚

ç°åœ¨åƒå¾€å¸¸ä¸€æ ·ï¼Œæ·»åŠ å‡ ä¸ªæ—¶é—´çº¿ï¼š

```
let subjectTimeline = TimelineView(title: "Emitted values")let measureTimeline = TimelineView(title: "Measured values")let view = VStack(spacing: 100) {  subjectTimeline  measureTimeline}PlaygroundPage.current.liveView = UIHostingController(rootView: view.frame(width: 375, height: 600))subject.displayEvents(in: subjectTimeline)measureSubject.displayEvents(in: measureTimeline)
```

æœ€åï¼Œæœ‰è¶£çš„éƒ¨åˆ†æ¥äº†ã€‚ æ‰“å°å‡ºä¸¤ä¸ªå‘å¸ƒè€…å‘å‡ºçš„å€¼ï¼š

```
let subscription1 = subject.sink {    print("+\(deltaTime)s: Subject emitted: \($0)")}let subscription2 = measureSubject.sink {    print("+\(deltaTime)s: Measure emitted: \($0)")}subject.feed(with: typingHelloWorld)
```

è¿è¡Œä½ çš„ Playground å¹¶æŸ¥çœ‹è°ƒè¯•åŒºåŸŸï¼ åœ¨è¿™é‡Œä½ å¯ä»¥çœ‹åˆ° `measureInterval(using:)` å‘å‡ºçš„åº¦é‡å€¼ï¼š

```
+0.0s: Subject emitted: H+0.0s: Measure emitted: Stride(magnitude: 16818353)+0.1s: Subject emitted: He+0.1s: Measure emitted: Stride(magnitude: 87377323)+0.2s: Subject emitted: Hel+0.2s: Measure emitted: Stride(magnitude: 111515697)+0.3s: Subject emitted: Hell+0.3s: Measure emitted: Stride(magnitude: 105128640)+0.5s: Subject emitted: Hello+0.5s: Measure emitted: Stride(magnitude: 228804831)+0.6s: Subject emitted: Hello +0.6s: Measure emitted: Stride(magnitude: 104349343)+2.2s: Subject emitted: Hello W+2.2s: Measure emitted: Stride(magnitude: 1533804859)+2.2s: Subject emitted: Hello Wo+2.2s: Measure emitted: Stride(magnitude: 154602)+2.4s: Subject emitted: Hello Wor+2.4s: Measure emitted: Stride(magnitude: 228888306)+2.4s: Subject emitted: Hello Worl+2.4s: Measure emitted: Stride(magnitude: 138241)+2.7s: Subject emitted: Hello World+2.7s: Measure emitted: Stride(magnitude: 333195273)
```

è¿™äº›å€¼æœ‰ç‚¹ä»¤äººè´¹è§£ã€‚æ ¹æ®æ–‡æ¡£ï¼ŒmeasureInterval å‘å‡ºçš„å€¼çš„ç±»å‹æ˜¯â€œæä¾›çš„è°ƒåº¦ç¨‹åºçš„æ—¶é—´é—´éš”â€ã€‚ åœ¨ DispatchQueue çš„æƒ…å†µä¸‹ï¼ŒTimeInterval å®šä¹‰ä¸ºâ€œä½¿ç”¨æ­¤ç±»å‹çš„å€¼åˆ›å»ºçš„ DispatchTimeIntervalï¼Œä»¥çº³ç§’ä¸ºå•ä½ã€‚â€ã€‚

ä½ åœ¨è¿™é‡Œçœ‹åˆ°çš„æ˜¯ä»æºä¸»é¢˜æ¥æ”¶åˆ°çš„æ¯ä¸ªè¿ç»­å€¼ä¹‹é—´çš„è®¡æ•°ï¼ˆä»¥çº³ç§’ä¸ºå•ä½ï¼‰ã€‚ ä½ ç°åœ¨å¯ä»¥ä¿®å¤æ˜¾ç¤ºä»¥æ˜¾ç¤ºæ›´å…·å¯è¯»æ€§çš„å€¼ã€‚ ä¿®æ”¹ä» measureSubject æ‰“å°å€¼çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
let subscription2 = measureSubject.sink {  print("+\(deltaTime)s: Measure emitted: \(Double($0.magnitude) / 1_000_000_000.0)")}
```

ç°åœ¨ï¼Œä½ å°†åœ¨å‡ ç§’é’Ÿå†…çœ‹åˆ°å€¼ã€‚

ä½†æ˜¯å¦‚æœä½ ä½¿ç”¨ä¸åŒçš„è°ƒåº¦å™¨ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ ä½ å¯ä»¥ä½¿ç”¨ RunLoop è€Œä¸æ˜¯ DispatchQueue è¿›è¡Œå°è¯•ï¼

> æ³¨æ„ï¼šä½ å°†åœ¨åæ–‡æ·±å…¥æ¢ç´¢ RunLoop å’Œ DispatchQueue è°ƒåº¦ç¨‹åºã€‚

å›åˆ°æ–‡ä»¶é¡¶éƒ¨ï¼Œåˆ›å»ºç¬¬äºŒä¸ªä½¿ç”¨ RunLoop çš„ä¸»é¢˜ï¼š

```
let measureSubject2 = subject.measureInterval(using: RunLoop.main)
```

ä½ æ— éœ€è´¹å¿ƒè¿æ¥æ–°çš„æ—¶é—´çº¿è§†å›¾ï¼Œå› ä¸ºæœ‰è¶£çš„æ˜¯è°ƒè¯•è¾“å‡ºã€‚å°†ç¬¬ä¸‰ä¸ªè®¢é˜…æ·»åŠ åˆ°ä½ çš„ä»£ç ä¸­ï¼š

```
let subscription3 = measureSubject2.sink {    print("+\(deltaTime)s: Measure2 emitted: \($0)")}
```

ç°åœ¨ï¼Œä½ è¿˜å°†çœ‹åˆ° RunLoop è°ƒåº¦ç¨‹åºçš„è¾“å‡ºï¼Œå…¶å¹…åº¦ç›´æ¥ä»¥ç§’è¡¨ç¤ºï¼š

```
+0.0s: Subject emitted: H+0.0s: Measure emitted: 0.016503769+0.0s: Measure2 emitted: Stride(magnitude: 0.015684008598327637)+0.1s: Subject emitted: He+0.1s: Measure emitted: 0.087991755+0.1s: Measure2 emitted: Stride(magnitude: 0.08793699741363525)+0.2s: Subject emitted: Hel+0.2s: Measure emitted: 0.115842671+0.2s: Measure2 emitted: Stride(magnitude: 0.11583995819091797)...
```

ä½ ç”¨äºæµ‹é‡çš„è°ƒåº¦ç¨‹åºå®é™…ä¸Šå–å†³äºä½ çš„ä¸ªäººå–œå¥½ã€‚å¯¹æ‰€æœ‰äº‹æƒ…éƒ½åšæŒä½¿ç”¨ DispatchQueue é€šå¸¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ ä½†è¿™æ˜¯ä½ ä¸ªäººçš„é€‰æ‹©ï¼

#### æŒ‘æˆ˜

**æŒ‘æˆ˜ï¼šData**

å¦‚æœæ—¶é—´å…è®¸ï¼Œä½ å¯èƒ½æƒ³å°è¯•ä¸€ç‚¹æŒ‘æˆ˜æ¥å……åˆ†åˆ©ç”¨è¿™äº›æ–°çŸ¥è¯†ï¼

æ‰“å¼€é¡¹ç›®/æŒ‘æˆ˜æ–‡ä»¶å¤¹ä¸­çš„ Playgroundã€‚ä½ ä¼šçœ‹åˆ°ä¸€äº›ä»£ç åœ¨ç­‰ç€ä½ ï¼š

* å‘å‡ºæ•´æ•°çš„ subjectã€‚
* å‘ subject æä¾›ç¥ç§˜æ•°æ®çš„å‡½æ•°è°ƒç”¨ã€‚

åœ¨è¿™äº›éƒ¨åˆ†ä¹‹é—´ï¼Œä½ çš„æŒ‘æˆ˜æ˜¯ï¼š

* ä»¥ 0.5 ç§’ä¸ºå•ä½å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ã€‚
* å°†åˆ†ç»„æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚
* å¦‚æœææš‚åœæ—¶é—´è¶…è¿‡ 0.9 ç§’ï¼Œè¯·æ‰“å° ğŸ‘ è¡¨æƒ…ç¬¦å·ã€‚æç¤ºï¼šä¸ºæ­¤æ­¥éª¤åˆ›å»ºç¬¬äºŒä¸ªå‘å¸ƒè€…å¹¶å°†å…¶ä¸è®¢é˜…ä¸­çš„ç¬¬ä¸€ä¸ªå‘å¸ƒè€…åˆå¹¶ã€‚
* æ‰“å°å®ƒã€‚

> æ³¨æ„ï¼šè¦å°† Int è½¬æ¢ä¸º Characterï¼Œä½ å¯ä»¥æ‰§è¡Œ Character(Unicode.Scalar(value)!) ä¹‹ç±»çš„æ“ä½œã€‚

å¦‚æœä½ æ­£ç¡®åœ°ç¼–ç äº†è¿™ä¸ªæŒ‘æˆ˜ï¼Œä½ ä¼šåœ¨ Debug åŒºåŸŸçœ‹åˆ°ä¸€ä¸ªæ‰“å°çš„å¥å­ã€‚å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ

#### è§£å†³æ–¹æ¡ˆ

ä½ å°†åœ¨ challenge/Final.playgroundä¸­æ‰¾åˆ°è¯¥æŒ‘æˆ˜çš„è§£å†³æ–¹æ¡ˆã€‚

è¿™æ˜¯è§£å†³æ–¹æ¡ˆä»£ç ï¼š

```
// 1let strings = subject// 2    .collect(.byTime(DispatchQueue.main, .seconds(0.5)))// 3    .map { array in        String(array.map { Character(Unicode.Scalar($0)!) })    }â€‹// 4let spaces = subject.measureInterval(using: DispatchQueue.main)    .map { interval in        // 5        interval > 0.9 ? "ğŸ‘" : ""    }â€‹// 6let subscription = strings    .merge(with: spaces)// 7    .filter { !$0.isEmpty }    .sink {        // 8        print($0)    }
```

ä¸Šè¿°ä»£ç ï¼š

1. åˆ›å»ºä»å‘å‡ºå­—ç¬¦ä¸²çš„ subject æ´¾ç”Ÿçš„ç¬¬ä¸€ä¸ªå‘å¸ƒè€…ã€‚
2. ä½¿ç”¨ collect() ä½¿ç”¨ .byTime ç­–ç•¥ä»¥ 0.5 ç§’çš„æ‰¹æ¬¡å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ã€‚
3. å°†æ¯ä¸ªæ•´æ•°å€¼æ˜ å°„åˆ° Unicode Scalarï¼Œç„¶åæ˜ å°„åˆ°å­—ç¬¦ï¼Œç„¶åä½¿ç”¨ map å°†æ•´ä¸ªæ•´æ•°å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚
4. åˆ›å»ºä» subject æ´¾ç”Ÿçš„ç¬¬äºŒä¸ªå‘å¸ƒè€…ï¼Œå®ƒæµ‹é‡æ¯ä¸ªå­—ç¬¦ä¹‹é—´çš„é—´éš”ã€‚
5. å¦‚æœé—´éš”å¤§äº0.9ç§’ï¼Œå°†å€¼æ˜ å°„åˆ°ğŸ‘è¡¨æƒ…ç¬¦å·ã€‚å¦åˆ™ï¼Œå°†å…¶æ˜ å°„åˆ°ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚
6. æœ€ç»ˆå‘å¸ƒè€…æ˜¯å­—ç¬¦ä¸²å’ŒğŸ‘è¡¨æƒ…ç¬¦å·çš„åˆå¹¶ã€‚
7. è¿‡æ»¤æ‰ç©ºå­—ç¬¦ä¸²ä»¥è·å¾—æ›´å¥½çš„æ˜¾ç¤ºã€‚
8. æ‰“å°ç»“æœï¼

ä½ çš„è§£å†³æ–¹æ¡ˆå¯èƒ½ç•¥æœ‰ä¸åŒï¼Œè¿™æ²¡å…³ç³»ã€‚åªè¦æ»¡è¶³è¦æ±‚å³å¯ï¼

ä½¿ç”¨æ­¤è§£å†³æ–¹æ¡ˆè¿è¡Œ Playground ä¼šå°†ä»¥ä¸‹è¾“å‡ºæ‰“å°åˆ°æ§åˆ¶å°ï¼š

```
ç»“åˆğŸ‘æ˜¯ğŸ‘å‡‰çˆ½çš„ï¼
```

#### å…³é”®ç‚¹

åœ¨æœ¬ç« ä¸­ï¼Œä½ ä»ä¸åŒçš„è§’åº¦çœ‹å¾…æ—¶é—´ã€‚ç‰¹åˆ«æ˜¯ï¼Œä½ äº†è§£åˆ°ï¼š

* Combine å¯¹å¼‚æ­¥äº‹ä»¶çš„å¤„ç†æ‰©å±•åˆ°æ“çºµæ—¶é—´æœ¬èº«ã€‚
* è¯¥æ¡†æ¶å…·æœ‰å…è®¸ä½ åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…æŠ½è±¡å·¥ä½œçš„æ“ä½œç¬¦ï¼Œè€Œä¸ä»…ä»…æ˜¯å¤„ç†ç¦»æ•£äº‹ä»¶ã€‚
* å¯ä»¥ä½¿ç”¨ delay æ“ä½œç¬¦æ¥ç§»åŠ¨æ—¶é—´ã€‚
* ä½ å¯ä»¥ä½¿ç”¨ collect åˆ†å—æ”¶é›†å®ƒä»¬ã€‚
* ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµé€‰æ‹©å•ä¸ªå€¼ã€‚
* ä¸è®©æ—¶é—´ç”¨å®Œæ˜¯ timeout çš„å·¥ä½œã€‚
* æ—¶é—´å¯ä»¥ç”¨ measureInterval æ¥æµ‹é‡ã€‚

#### æ¥ä¸‹æ¥å»å“ªï¼Ÿ

è¿™éœ€è¦å­¦ä¹ å¾ˆå¤šä¸œè¥¿ã€‚è¦å°†äº‹ä»¶æŒ‰æ­£ç¡®çš„é¡ºåºæ’åˆ—ï¼Œè¯·è½¬åˆ°ä¸‹ä¸€ç« å¹¶äº†è§£åºåˆ—æ“ä½œç¬¦ï¼
